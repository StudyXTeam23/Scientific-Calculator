═══════════════════════════════════════════════════════════════
  🚀 Scientific Calculator - 端口 18333 快速部署卡片
═══════════════════════════════════════════════════════════════

📦 第 1 步：上传文件到服务器
────────────────────────────────────────────────────────────
Windows 上执行：
  cd f:\workspace\demo02
  tar -czf calculator.tar.gz --exclude=node_modules --exclude=.next newProduct/
  scp calculator.tar.gz username@your-server-ip:/var/www/calculator/

服务器上执行：
  cd /var/www/calculator
  tar -xzf calculator.tar.gz --strip-components=1

═══════════════════════════════════════════════════════════════

🔧 第 2 步：构建和启动应用（服务器上）
────────────────────────────────────────────────────────────
cd /var/www/calculator
npm install --production
npm run build
pm2 start npm --name "calculator" -- start
pm2 startup
pm2 save

验证：curl http://localhost:18333

═══════════════════════════════════════════════════════════════

🌐 第 3 步：配置 Nginx
────────────────────────────────────────────────────────────
sudo nano /etc/nginx/sites-available/calculator

粘贴配置（见 nginx-18333.conf 文件）：
  server {
      listen 80;
      server_name your-domain.com;
      
      location / {
          proxy_pass http://localhost:18333;
          proxy_http_version 1.1;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          ...
      }
  }

启用配置：
  sudo ln -s /etc/nginx/sites-available/calculator /etc/nginx/sites-enabled/
  sudo nginx -t
  sudo systemctl restart nginx

═══════════════════════════════════════════════════════════════

🔒 第 4 步：配置 HTTPS（可选但推荐）
────────────────────────────────────────────────────────────
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com

═══════════════════════════════════════════════════════════════

✅ 验证部署
────────────────────────────────────────────────────────────
pm2 status                           # 应显示 online
netstat -tulpn | grep 18333          # 应显示端口在监听
curl http://your-domain.com          # 应返回 HTML
浏览器访问: http://your-domain.com   # 测试功能

═══════════════════════════════════════════════════════════════

📋 常用命令
────────────────────────────────────────────────────────────
pm2 status                  # 查看应用状态
pm2 logs calculator         # 查看日志
pm2 restart calculator      # 重启应用
sudo nginx -t               # 测试 Nginx 配置
sudo systemctl restart nginx # 重启 Nginx

═══════════════════════════════════════════════════════════════

🔧 故障排查
────────────────────────────────────────────────────────────
502 错误：
  pm2 restart calculator
  pm2 logs calculator
  
端口被占用：
  netstat -tulpn | grep 18333
  sudo lsof -i :18333

无法访问：
  sudo ufw allow 'Nginx Full'
  sudo systemctl status nginx
  ping your-domain.com

═══════════════════════════════════════════════════════════════

📚 详细文档
────────────────────────────────────────────────────────────
DEPLOY_PORT_18333.md     - 完整部署指南
nginx-18333.conf         - Nginx 配置文件
NGINX_DEPLOYMENT.md      - 通用 Nginx 部署指南

═══════════════════════════════════════════════════════════════

⚠️  重要配置
────────────────────────────────────────────────────────────
✅ 应用端口: 18333
✅ package.json: "start": "next start -p 18333"
✅ Nginx 代理: proxy_pass http://localhost:18333
✅ 防火墙: 需要开放端口 80, 443（可选开放 18333）

═══════════════════════════════════════════════════════════════

预计部署时间：15-30 分钟
祝部署顺利！🎉

